# 共同開発の基本

GitHub Flow に従った共同開発の現場において、個人の作業は以下の繰り返しです。

1. **main からブランチを生やす**
2. **ブランチ内でコミットをしていく**
3. **変更が済んだらプルリクエストを立てる**
4. **main にマージする**

ここまでの操作で全て体験できましたね。この章ではそれぞれの操作の意味を明確にします。

## プルリクエスト

**プルリクエスト**（Pull Request, PR）という機能はバージョン管理ツールとしての Git 自体には存在せず、GitHub や Gitea などのホスティングサービスの側が提供しています。前章では色々とすっ飛ばしてマージまで行ってしまいましたが、共同開発では本来ここで変更点に問題がなさそうか、チームの審判を仰ぐためのワンクッションとして機能するものです。

:::warning プルリクエストは「プルのリクエスト」ではない
プルリクエストの趣旨は「このブランチを main に **マージ** してほしい」であって、その先の「このブランチがマージされたら各自で main を **プル** してほしい」ではありません。歴史的経緯から「プルリクエスト」という名前で今まで通ってきたものの、ややこしいという指摘は未だに受け続けているようです。GitHub や Gitea では「プルリクエスト」と呼ばれていますが、他の著名なホスティングサービスの一つである GitLab では「マージリクエスト」というより直感的な表現が使われています。
:::

マージという言葉には前編で説明した以上の意味があることがお分かりになるかと思います。一般に「**ブランチの変更内容同士を統合すること**」をマージと呼びます。

「sub → main のマージ」とは main ブランチから sub ブランチを生やして以降の main と sub それぞれの変更を統合して main に反映させることを意味します。ところが、前章までの実習では sub ブランチをマージするまでの間 main ブランチに何も変更を加えていないので、マージによって main に sub の変更がそのまま反映されたのです。

:::warning マージ元はマージの影響を受けない
sub の変更を main にマージした直後でも sub と main が全く同じ状態になるとは限らないことに注意が必要です。マージされるのは「状態」ではなく「**変更**」なので、sub ブランチの中で変更された箇所以外の sub ブランチの内容は main には影響を与えません。

![](https://md.trap.jp/uploads/upload_8b27e59a114f984bf7c41d456dc95b40.png)
<p style="font-size: 12px; text-align: center; margin: -8px 0 0 0">sub をマージしてもファイル A の状態が戻るわけではない</p>
:::

ブランチが途中で生えたりマージされたりするとコミットグラフはこんな感じになります。

![](https://md.trap.jp/uploads/upload_8354df7754459cfd08b0e67b333e8b19.png)

:::tip ブランチという命名について
そもそも、ほとんどの場合「あとで main にマージする」ために生やすものを「木の枝（ブランチ）」と呼ぶのもちょっと変な話ではありますね。上の図のようにブランチがマージしてしまったら、コミットグラフは少なくともグラフ理論における「木」の定義には当てはまらないものになります。ブランチがちゃんと「枝」っぽく見えるのは、そのブランチがマージされていない間だけです。
:::

## Gitea の機能

Gitea など多くのホスティングサービスは共同開発の効率化のために様々な機能を提供しています。これらはプルリクエストと同じく Git には存在しない機能です。

- **Issue** ... Gitea や GitHub には、そのプロダクトについて「現状の問題点」とか「やるべきこと」をメモ・共有するために Issue を立てる機能があります。Issue にはその問題点の性質を示すタグをつけることができます。[traQ フロントエンドリポジトリ の Issues](https://github.com/traPtitech/traQ_S-UI/issues) を見るとこの機能の意義が掴めると思います。

- **レビュー** ... 立てられたプルリクエストにおける変更に問題がなさそうかを検証することです。Gitea 上でもレビューをするための UI や機能が提供されていて、1 人以上の Approve がなければプルリクエストのマージができないような設定にすることもできます。

:::tip README.md とは何か
これまで README.md というテキストファイルを編集しながら Git の操作を学んできました。

README.md は Gitea などのホスティングサービスによって特殊な扱いを受けるファイルです。具体的には、もし Git リポジトリの中に README.md というファイルが含まれていれば、Gitea 上のリポジトリのページではそのファイルの最新の状態を大きく表示します。

![](https://md.trap.jp/uploads/upload_19bdd8d79f84cc5219f31e028a3a7e2d.png)

「私を読んで！」という意味の名前から察されるように、この README.md というファイルは本来**開発者がそのリポジトリで何を開発しているかの説明**を Markdown 形式で書くためのものです。[traQ フロントエンドリポジトリ](https://github.com/traPtitech/traQ_S-UI) の README.md などはよい書き方の例です。

とはいえ、リポジトリを開発以外の用途に供していたり、そもそも非公開に設定していたりする場合、README.md を詳しく書く必要はありません。この講習会が README.md を編集することにしているのは、単純に Gitea 上でファイルの最新の状態をすぐに確認できれば Git の操作をもっと確認しやすくなると考えているからです。
:::