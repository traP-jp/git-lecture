# 補足 - Git の操作の実体

この章では、前編で行ってきた VSCode 上のボタン操作の裏でどんな処理がなされていたのかを解説し `fetch` や `pull` といったコマンドとの関係性を明らかにします。

大抵の開発ではこれらの操作の細かい意味合いはあまり強く意識されず、それを深く理解していなくても Git を開発に役立てることは十分に可能です。とはいえ、これらは Git の最も基本的な操作とされていて、その役割を把握していなければ解決が難しい問題に遭遇することも稀ではないので、以降の内容をなんとなくでも把握しておくことをおすすめします。

## 3 本のミクロブランチ

以下の図は 1 本のブランチ（ここでは main という名前のブランチ）に関する操作の一覧です。

![](https://md.trap.jp/uploads/upload_fe0acf2d984af0a2625cffd252fb1d02.png)

全体が同期するので 1 本と見なすことが一般的ですが、実際には

- **リモートブランチ**
- **リモート追跡ブランチ**
- **作業ブランチ**

の 3 本が束になっています。一般的な呼び方ではないですが、以降はこれらを **ミクロブランチ** と呼ぶことにします。逆に、単に「ブランチ」というときは 3 本のミクロブランチが束になったマクロなブランチを指すものとします。それぞれの役割は以下の通りです。

- **リモートブランチ** ... Gitea のサーバーに保存されている
- **リモート追跡ブランチ** ... ある瞬間におけるリモートブランチの写し。`origin/` から始まる
- **作業ブランチ** ... 実際に開発作業をする（変更を加える）ミクロブランチ

上図における各操作の意味は以下の通りです。

|    操作    | 意味                                                                                                          |
| :--------: | :------------------------------------------------------------------------------------------------------------ |
| **clone**  | GitHub のサーバー上のリモートブランチをコピーして、ローカル環境にリモート追跡ブランチと作業ブランチを用意する |
| **fetch**  | リモートブランチの変更をリモート追跡ブランチに反映する                                                        |
| **merge**  | リモート追跡ブランチの変更を作業ブランチに反映する                                                            |
| **commit** | 作業ブランチに変更を加えること                                                                                |
|  **pull**  | fetch + merge                                                                                                 |
|  **push**  | 作業ブランチの変更をリモートブランチに反映する                                                                |

前編でターミナル及び VSCode 上で行った操作との対応は以下のようになります。

<table style="width: 100%; border-collapse: collapse;">
  <tr>
    <th style="width: 100%;">操作</th>
    <th style="width: auto;">Git コマンド</th>
  </tr>
  <tr>
    <td>コマンド <code>git clone {リポジトリの URL}</code> の実行</td>
    <td><strong>clone</strong></td>
  </tr>
  <tr>
    <td>デスクトップの mydrive で README.md を編集して「コミット」ボタンを押す</td>
    <td><strong>commit</strong></td>
  </tr>
  <tr>
    <td>デスクトップの mydrive で「変更を同期」ボタンを押す</td>
    <td style="text-wrap: nowrap"><strong>push</strong> + <strong>fetch</strong></td>
  </tr>
  <tr>
    <td>ダウンロードの mydrive で「変更の同期」ボタンを押す</td>
    <td><strong>pull</strong></td>
  </tr>
</table>

:::info コミット ≠ ファイルの編集
commit の説明として「作業ブランチに変更を加えること」と書きましたが、上記の対応から分かるように、ただ単に作業ディレクトリのファイルの内容を変更するだけでは commit にはなりません。ファイルの変更をステージし、明示的にコミットして初めてブランチが伸びます。
:::

「1 本のブランチが 3 本のミクロブランチで構成されている」という話は実際の開発においてはほとんど意識されません。日頃の開発で「ブランチにコミットする」という言葉を聞いたら、それは多くの場合「マクロなブランチ」へのコミットの話なので、以下の一連の操作を指すと思ってよいでしょう。

1. 開発途中のブランチの最新状態をリモートから pull してくる
2. ファイルの中身を変更し、作業ブランチに commit する
3. 作業ブランチの変更を push してリモートブランチに反映させ、fetch してリモート追跡ブランチにも反映させておく

1 と 3 は結局のところ「3 本のミクロブランチを同期する」ための操作です。「（マクロな）ブランチへのコミット」という操作は「**同期** → **作業ブランチへのコミット** → **同期**」という 3 段階によって 3 本のミクロブランチの全てに同じ変更を加えることを意味しています。